(()=>{"use strict";(new class{constructor(){this.parentEl=document.querySelector(".container")}init(){this.drawUI(),this.form=this.parentEl.querySelector(".form"),this.addTicket=this.addTicket.bind(this),this.input=this.parentEl.querySelector(".form-input"),this.form.addEventListener("submit",this.addTicket)}drawUI(){const t=document.createElement("div");t.classList.add("widget-container"),t.innerHTML='\n            <div class="list"></div>\n            <div class="footer">\n                <form class="form">\n                    <input class="form-input" name="input" type="text">\n                </form>\n            </div>',this.parentEl.appendChild(t)}addTicket(t){t.preventDefault(),this.getPosition()}getPosition(){navigator.geolocation&&navigator.geolocation.getCurrentPosition((t=>{const{latitude:e,longitude:i}=t.coords;this.showPost(e,i)}),(t=>{this.showModal()}))}showPost(t,e){this.list=this.parentEl.querySelector(".list"),this.post=document.createElement("div"),this.post.classList.add("post"),this.post.innerHTML=`\n            <div class="elem">\n                <span>${this.input.value}</span>\n            </div>\n            <div class="date">${(new Date).toLocaleString()}</div>\n            <div class="geo">[${t},${e}]</div>\n        `,this.list.insertAdjacentElement("afterbegin",this.post),this.resetInput()}resetInput(){this.input.value=""}showModal(){this.modal=document.createElement("div"),this.modal.classList.add("modal"),this.modal.innerHTML='\n            <div class="modal">\n                <h3>Что-то пошло не так</h3>\n                <p>Извините, но мы не можем определить ваше местоположение, \n                пожалуйста, дайте нам разрешение на использование геолокации \n                либо введите координаты вручную</p>\n                <p>Широта и долгота через запятую</p>\n                <form class="modal-form">\n                    <input class="modal-input" name="modal" type="text">\n                    <div class="btns">\n                        <button type="reset" class="reset">Отмена</button>\n                        <button type="submit" class="ok">Ok</button>\n                    </div>\n                </form>\n            </div>\n        ',this.parentEl.appendChild(this.modal),this.parentEl.querySelector(".modal-form").addEventListener("submit",(t=>{t.preventDefault();const e=this.parentEl.querySelector(".modal-input").value;let i=this.checkValidity(e);if(i){i=i[0].split(",");const t=i[0].trim(),e=i[1].trim();this.hideModal(),this.showPost(t,e)}else alert("Координаты введены не верно")})),this.parentEl.querySelector(".modal-form").addEventListener("reset",(t=>{t.preventDefault(),this.hideModal()}))}checkValidity(t){return t.match(/^\[?\d+\.\d+,\s?\-?\d+\.\d+\]?$/gm)}hideModal(){this.parentEl.querySelector(".modal").remove()}}).init()})();